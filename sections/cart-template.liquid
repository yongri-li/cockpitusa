<section class="cart-page ajax-cart__page-wrapper" data-section-type="cart">
  <div class="loading-wrapper js-mini-cart-loader">
    <div class="loading-ripple"><div></div><div></div></div>
  </div>

  <div class="ajax-cart__header-wrapper grid__wrapper edge">
    <div class="span-4 sm-span-4 auto a-left v-center">
      {%- if section.settings.link != blank -%}
        {%- assign continue_link = section.settings.link -%}
      {%- else -%}
        {%- assign continue_link = routes.collections_url -%}
      {%- endif -%}
      <a class="ajax-cart__header__continue-link mb0" href="{{ continue_link }}">
        <i class="fa fa-angle-left"></i>
        <span class="ajax-cart__header__continue-link-text sm-hide">{{ 'products.product.continue' | t }}</span>
      </a>
    </div>
    <div class="span-4 sm-span-4 auto v-center">
      <h1 class="section-heading a-center mb0">{{ 'cart.general.title' | t }}</h1>
    </div>
    <div class="span-4 sm-span-4 auto a-right v-center">
      <p class="mb0"><span class="js-cart-count inline-block">{{ cart.item_count }}</span> {{ 'cart.general.items' | t }}</p>
    </div>
  </div>

  <div class="ajax-cart__form-wrapper cart-wrapper js-ajax-cart-content">

  </div>
  {% if settings.cart_type == 'page_only' %}
    {% render 'cart-config', cart: cart %}
  {% endif %}
</section>

{% if linklists.gift-wrapping.links.size > 0 and linklists.gift-wrapping.links.first.type == 'product_link' %}
  {% assign id = linklists.gift-wrapping.links.first.object.variants.first.id %}
  {% assign gift_wraps_in_cart = 0 %}
  {% for item in cart.items %}
    {% if item.id == id %}
      {% assign gift_wraps_in_cart = item.quantity %}
    {% endif %}
  {% endfor %}

  <script>
    Shopify.Cart = Shopify.Cart || {};

    Shopify.Cart.GiftWrap = {};

    Shopify.Cart.GiftWrap.set = function() {
      jQuery.ajax({
        type: 'POST',
        url: '/cart/update.js',
        data: { updates: { {{ id }}: 1 }, attributes: { 'gift-wrapping': true } },
        dataType: 'json',
        success: function() { location.href = '/cart'; }
      });
    }

    Shopify.Cart.GiftWrap.remove = function() {
      jQuery.ajax({
        type: 'POST',
        url: '/cart/update.js',
        data: { updates: { {{ id }}: 0 }, attributes: { 'gift-wrapping': false } },
        dataType: 'json',
        success: function() { location.href = '/cart'; }
      });
    }

    // If we have nothing but gift-wrap items in the cart.
    {% if cart.items.size == 1 and gift_wraps_in_cart > 0 %}
    jQuery(function() {
      Shopify.Cart.GiftWrap.remove();
    });
    // If we have more than one gift-wrap item in the cart.
    {% elsif gift_wraps_in_cart > 1 %}

    jQuery(function() {
      Shopify.Cart.GiftWrap.set();
    });
    // If we have a gift-wrap item in the cart but our gift-wrapping cart attribute has not been set.
    {% elsif cart.attributes.gift-wrapping == blank  %}
    jQuery(function() {
      Shopify.Cart.GiftWrap.set();
    });
    {% endif %}

    // When the gift-wrapping checkbox is checked or unchecked.
    jQuery(function() {
      jQuery(document).on('change', '[name="attributes\[gift-wrapping\]"]', function() {
        if (jQuery(this).is(':checked')) {
          Shopify.Cart.GiftWrap.set();
        }
        else {
          Shopify.Cart.GiftWrap.remove();
        }
      });
    });
  </script>
{% endif %}

{% schema %}
{
  "name": "Cart Page",
  "settings": [
    {
      "type": "url",
      "id": "link",
      "label": "Continue shopping link"
    }
  ]
}
{% endschema %}
