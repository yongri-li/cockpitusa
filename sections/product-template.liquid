{%- liquid

  assign show_sku = settings.product_show_sku
  assign show_vendor = settings.product_show_vendor
  assign show_quantity = settings.product_show_quantity
  assign show_payment_button = settings.product_show_payment_button
  assign current_variant = product.selected_or_first_available_variant

-%}

<div id="product-{{ product.id }}"
class="product__section product-template prod-{{ section.id }}"
data-product-id="{{ product.id }}"
data-section-id="{{ section.id }}"
data-section-type="product__section"
data-initial-variant="{{ current_variant.featured_media.id }}">

  {% render 'product-json', product: product %}

  <div class="row grid_wrapper">
    {% render 'breadcrumb' %}

    {% case section.settings.image_section_size %}
    {% when 'small' %}
    {%- assign image_width = 'span-5 push-1 md-span-6 sm-span-12 auto' -%}
    {%- assign descr_width = 'span-5 md-span-6 sm-span-12 auto' -%}
    {% when 'medium' %}
    {%- assign image_width = 'span-6 sm-span-12 auto' -%}
    {%- assign descr_width = 'span-6 sm-span-12 auto' -%}
    {% when 'large' %}
    {%- assign image_width = 'span-8 md-span-6 sm-span-12 auto' -%}
    {%- assign descr_width = 'span-4 md-span-6 sm-span-12 auto' -%}
    {% endcase %}

    {% if section.settings.image_options == 'static' %}
      {% assign gallery_data = 'data-static-gallery' %}
      {% assign gallery_type = 'static' %}
    {% else %}
      {% assign gallery_data = 'data-scroll-gallery' %}
      {% assign gallery_type = 'scroll' %}
    {% endif %}

    {% assign thumbnail_position = section.settings.thumbnail_position %}
    {% assign click_to_enlarge = section.settings.click_to_enlarge %}
    {% assign enable_video_looping = section.settings.enable_video_looping %}
    {% capture product_gallery_config %}{
      "thumbPosition": {{ section.settings.thumbnail_position | json }},
      "thumbsShown": {{ section.settings.thumbs_to_show | json }},
      "clickToEnlarge": {{ section.settings.click_to_enlarge | json }},
      "enableVideoLooping": {{ section.settings.enable_video_looping | json }},
      "navStyle": {{ section.settings.slide_controls | json }},
      "mainSlider": {% if product.media.size <= 1 %}false{% else %}true{% endif %},
      "thumbSlider": {% if product.media.size >= 4 %}true{% else %}false{% endif %},
      "productId": {{ product.id | json }},
      "isQuick": false
    }{% endcapture %}

      <div class="product__section-images product-{{ product.id }} {{ image_width }}{% if gallery_type == 'static' %} carousel-container{% endif %} js-product-gallery"
           data-product-single-media-group data-gallery-config='{{ product_gallery_config }}'
           {{ gallery_data }}>

          {% if product.featured_media and gallery_type == 'static' %}
          	{% render 'product-static-gallery',
              product: product,
              thumbnail_position: thumbnail_position,
              click_to_enlarge: click_to_enlarge,
              enable_video_looping: enable_video_looping,
              thumbs_to_show: section.settings.thumbs_to_show %}

          {% elsif product.featured_media and gallery_type == 'scroll' %}
          	{% render 'product-scroll-gallery',
              product: product,
              thumbnail_position: thumbnail_position,
              click_to_enlarge: click_to_enlarge,
              enable_video_looping: enable_video_looping %}
          {% else %}
            {% capture current %}{% cycle 1, 2, 3, 4, 5, 6 %}{% endcapture %}
            {{ 'product-' | append: current | placeholder_svg_tag: 'placeholder-svg' }}
          {% endif %}
      </div>

    	<div class="product__section-content {{ descr_width }}">
        <div class="product__section-details {% if section.settings.image_options == 'scroll' %} is_sticky{% endif %}">
          <div class="product__section-title section-title">
            <h1>{{ product.title }}</h1>
          </div>
          {% capture description %}
            {% if section.blocks.size == 0 %}
              <div class="rte">
                {% if product.description contains '[#' %}
                {{ product.description | split: '[#' | first }}
                {% else %}
                {{ product.description | split: '<!-- split -->' | first }}
                {% endif %}
              </div>
            {% endif %}
            <div class="rte-tab">
              {% unless section.blocks.size == 0 %}
                {% for block in section.blocks %}
                    <input {% if forloop.first %}checked="checked"{% endif %} id="tab{{ forloop.index | plus:1 }}" type="radio" name="pct" />
                {% endfor %}
              {% endunless %}
              <nav>
                <ul class="tabbed">
                  {% unless section.blocks.size == 0 %}
                    {% for block in section.blocks %}
                      {% case block.type %}
                      {% when 'description' %}
                          <li class="tab{{ forloop.index | plus:1 }}"><label for="tab{{ forloop.index | plus:1 }}">{{ 'products.product.details' | t }}</label></li>
                      {% when 'page' %}
                      {% assign tab_page = pages[block.settings.page] %}
                          <li class="tab{{ forloop.index | plus:1 }}"><label for="tab{{ forloop.index | plus:1 }}">{{ tab_page.title }}</label></li>
                      {% when 'text' %}
                          <li class="tab{{ forloop.index | plus:1 }}"><label for="tab{{ forloop.index | plus:1 }}">{{ block.settings.tab_heading }}</label></li>
                      {% endcase %}
                    {% endfor %}
                  {% endunless %}
                </ul>
              </nav>
              <section>
                {% unless section.blocks.size == 0 %}
                  {% for block in section.blocks %}
                    {% case block.type %}
                    {% when 'description' %}
                      <div id="{{ block.id }}" class="tab{{ forloop.index | plus:1 }} tabbed-block rte">
                        {% if product.description contains '[#' %}
                        {{ product.description | split: '[#' | first }}
                        {% else %}
                        {{ product.description | split: '<!-- split -->' | first }}
                        {% endif %}
                      </div>
                    {% when 'page' %}
                    {% assign tab_page = pages[block.settings.page] %}
                      <div id="{{ block.id }}" class="tab{{ forloop.index | plus:1 }} tabbed-block rte">
                        {{ tab_page.content }}
                      </div>
                    {% when 'text' %}
                      <div id="{{ block.id }}" class="tab{{ forloop.index | plus:1 }} tabbed-block rte">
                        {{ block.settings.tab_content }}
                      </div>
                    {% endcase %}
                  {% endfor %}
                {% endunless %}
              </section>
            </div>
          {% endcapture %}

          {% if show_vendor %}
            <h3>{{ 'products.product.designer' | t }}: {{ product.vendor }}</h3>
            <div class="clear"></div>
          {% endif %}

          {% unless product.template_suffix == 'not-for-sale' %}
            {% capture product_form_config %}
             { "money_format": {{ shop.money_format | json }},
               "enable_history": true,
               "sold_out": {{ "products.product.sold_out" | t | json }},
               "button": {{ 'products.product.add_to_cart' | t | json }},
               "unavailable": {{ 'products.product.unavailable' | t | json }},
               "quickview": {% if template == 'product.quick' %}true{% else %}false{% endif %}
             }
             {% endcapture %}

            <div class="product-form">
              {% render 'product-form',
                product: product,
                product_form_config: product_form_config,
                current_variant: current_variant,
                show_sku: show_sku,
                show_quantity: show_quantity,
                show_payment_button: show_payment_button %}
            </div>
          {% endunless %}

           <div class="clear"></div>
           <div class="product-single__store-availability-container" data-store-availability-container>
           </div>
           <div class="clear"></div>

          {% if product.description contains '[#size]' or product.description contains '[#other]' %}
            <div class="product-extra">
              {% if section.settings.show_product_size_chart and product.description contains '[#size]' %}
                {% assign shortcode_description = product.description | split: '[/size]' | first | split: '[#size]' | last %}
                <button class="button-as-link js-modal-open" type="button" name="button" data-wau-modal-target="product-size-chart">{{ 'products.product.sizing' | t }}</button>
                  <div data-wau-modal-content="product-size-chart" style="display: none;">
                    {{ shortcode_description }}
                  </div>
              {% endif %}
              {% if section.settings.show_product_model and product.description contains '[#other]' %}
              <button class="button-as-link js-modal-open" type="button" name="button" data-wau-modal-target="product-model">{{ 'products.product.model' | t }}</button>
                  <div data-wau-modal-content="product-model" style="display: none;">
                    {% assign shortcode_description = product.description | split: '[/other]' | first | split: '[#other]' | last %}
                    {{ shortcode_description }}
                  </div>
              {% endif %}
            </div>
          {% endif %}

          {% if section.settings.product_description_position == 'below' %}
            <div class="clear"></div>
            {{ description }}
          {% endif %}
          <div class="clear"></div>

        </div>
      </div>
  </div><!-- Close the wrapper / container allowing full width layout for lower  container -->
  {%- if section.settings.show_social_share -%}
    {% render 'social' with product %}
  {%- endif -%}
  {% if section.settings.lower_description == 'large' %}
   {%- assign lower = 'span-12 auto' -%}
  {% elsif section.settings.lower_description == 'medium' %}
   {%- assign lower = 'span-8 push-2 md-span-12 sm-span-12 auto' -%}
  {% elsif section.settings.lower_description == 'small' %}
   {%- assign lower = 'span-6 push-3 md-span-12 sm-span-12 auto' -%}
  {% endif %}

  {% if section.settings.product_description_position == 'bottom' or product.description contains '<!-- split -->' %}
    <div class="clear"></div>

    <div class="full-width-container">
      <div class="row grid_wrapper">
          <div class="mobile-3 {{ lower }}" data-aos="{{ settings.scroll_animation }}">
            <div class="section-title">
              <h3>{{ 'products.product.details' | t }}</h3>
            </div>
            <div class="rte">
              {% if section.settings.product_description_position == 'bottom' %}
              {{ description }}
              {% endif %}
              {% if product.description contains '<!-- split -->' %}
              <br />
              {{ product.description | split: '<!-- split -->' | last }}
              {% endif %}
            </div>
          </div>
      </div>
    </div>
  {% endif %}
  <div class="clear"></div>
  {% if section.settings.enable_product_reviews %}
    <div id="product-reviews" class="{{ lower }} mobile-3">
      <div class="section-title">
        <h3>{{ section.settings.reviews_heading }}</h3>
      </div>
      <div id="shopify-product-reviews" data-id="{{product.id}}" data-aos="{{ settings.scroll_animation }}">
        {{ product.metafields.spr.reviews }}
      </div>
    </div>
    <div class="clear"></div>
  {% endif %}
  <style>
  {% if section.settings.description_background != 'rgba(0,0,0,0)' %}
    :root {
      --color-body: {{ section.settings.description_background }};
    }
    .product__section-details {
      background: {{ section.settings.description_background }};
    }
  {% endif %}
  {% if section.settings.product_description_position == 'bottom' or product.description contains '<!-- split -->' %}
  .full-width-container {
    background: {{ section.settings.lower_description_background }};
    padding: 40px 0;
    margin-top: 20px;
    margin-bottom: 20px;
  }
  {% endif %}

  {% if section.settings.image_options == 'static' %}
    {% case section.settings.thumbnail_position %}
      {% when 'below' %}
      #product-{{ product.id }} .thumb-slider-slides {
        transition: left 0.5s ease-in-out;
      }
        .product-thumbnails {
          margin-top: 10px;
          padding: 0 30px;
        }
        .product-thumbnail {
          padding: 10px;
        }
      {% else %}
        #product-{{ product.id }} .thumb-slider-slides {
          transition: top 0.5s ease-in-out;
        }
    {% endcase %}
  {% elsif section.settings.image_options == 'scroll' %}
    .product-main-images {
        margin-bottom: -20px! important;
    }
  {% endif %}
  {% if section.settings.product_description_position != 'below' %}
    .product__section-details form {
      border-bottom: 0;
      margin-bottom: 0;
    }
    .add {
      margin-bottom: 8px! important;
    }
    {% endif %}
    {% if section.settings.show_banner == false and settings.breadcrumb == false %}
    .product__section { margin-top: 30px; }
    {% endif %}

  </style>
</div>
<script type="application/json" id="ModelJson-{{ section.id }}">
  {{ product.media | where: 'media_type', 'model' | json }}
</script>
{% schema %}
{
    "name": "Product Page",
    "max_blocks":5,
    "settings": [
      {
        "type":"header",
        "content":"Media"
      },
      {
        "type": "checkbox",
        "id": "click_to_enlarge",
        "label": "Enable click to enlarge",
        "default": true
      },
      {
        "type": "select",
        "id": "image_section_size",
        "label": "Gallery size",
        "options": [
          {
            "value": "small",
            "label": "Small"
          },
          {
            "value": "medium",
            "label": "Medium"
          },
          {
            "value": "large",
            "label": "Large"
          }
        ],
        "default":"medium"
      },
      {
        "type": "select",
        "id": "image_options",
        "label": "Gallery type",
        "options": [
          {
            "value": "static",
            "label": "Slideshow with thumbnails"
          },
          {
            "value": "scroll",
            "label": "Scroll gallery"
          }
        ]
      },
      {
        "type":"header",
        "content":"Slideshow"
      },
      {
        "type": "select",
        "id": "thumbnail_position",
        "label": "Slideshow thumbnail position",
        "options": [
          {
            "value": "right",
            "label": "Right"
          },
          {
            "value": "left",
            "label": "Left"
          },
          {
            "value": "bottom",
            "label": "Bottom"
          }
        ]
      },
      {
        "type": "range",
        "id": "thumbs_to_show",
        "min": 0,
        "max": 6,
        "step": 1,
        "label": "Thumbnail images to show",
        "default": 3,
        "info":"Set to 0 to show a slideshow without thumbnails"
      },
      {
        "type": "select",
        "id": "slide_controls",
        "label": "Slider control style",
        "default": "arrows",
        "options": [
          {
            "value": "arrows",
            "label": "Arrows"
          },
          {
            "value": "dots",
            "label": "Dots"
          }
        ]
      },
      {
        "type":"header",
        "content":"Video"
      },
      {
        "type": "checkbox",
        "id": "enable_video_looping",
        "label": "Enable video looping",
        "default": false
      },
      {
        "type": "paragraph",
        "content": "Learn more about [Media types](https:\/\/help.shopify.com/en\/manual\/products\/product-media\)"
      },
      {
        "type":"header",
        "content":"Form options"
      },
      {
        "type": "color",
        "id":"description_background",
        "label":"Background color"
      },
      {
        "type": "checkbox",
        "id": "back_in_stock",
        "label": "Show back in stock form",
        "default": true
      },
      {
        "type": "richtext",
        "id": "back_in_stock_text",
        "label": "Back in stock text",
        "default": "<p>Email me when this is available</p>"
      },
      {
       "type": "checkbox",
       "id": "show_social_share",
       "label": "Show social share icons",
       "default": true
      },
      {
       "type":"header",
       "content":"Content options"
      },
      {
       "type": "select",
       "id": "product_description_position",
       "label": "Product description position",
       "options": [
         {
           "value": "below",
           "label": "Beneath product options"
         },
         {
           "value": "bottom",
           "label": "Below images and options"
         }
       ]
      },
      {
       "type": "select",
       "id": "lower_description",
       "label": "Lower description size",
       "options": [
         {
           "value": "small",
           "label": "Small"
         },
         {
           "value": "medium",
           "label": "Medium"
         },
         {
           "value": "large",
           "label": "Large"
         }
       ]
      },
       {
         "type": "color",
         "id":"lower_description_background",
         "label":"Background color"
       },
       {
          "type": "header",
          "content": "Product Shortcode Popups"
        },
        {
          "type": "paragraph",
          "content": "Use shortcodes in your product description to show links to popups with unique product specific content. [Learn more](https:\/\/support.weareunderground.com\/article\/260-mr-parker-theme-product-shortcode-popups)"
        },
        {
          "type": "checkbox",
          "id": "show_product_size_chart",
          "label": "Show product size",
          "info": "Use shortcode [#size][/size]",
          "default": false
        },
        {
          "type": "checkbox",
          "id": "show_product_model",
          "label": "Show product fit/care",
          "info": "Use shortcode [#other][/other]",
          "default": false
        },
        {
          "type": "header",
          "content": "Product Reviews"
        },
        {
          "type": "paragraph",
          "content": "For reviews to work you must first install the free [Product Reviews](https:\/\/apps.shopify.com\/product-reviews) App by Shopify."
        },
        {
          "type": "checkbox",
          "id": "enable_product_reviews",
          "label": "Enable product reviews",
          "default": false
        },
        {
          "type": "text",
          "id": "reviews_heading",
          "label": "Heading",
          "default": "Customer Reviews"
        }
      ],
    "max_blocks": 5,
    "blocks":[
    {
      "type":"description",
      "name":"Product Description",
      "limit": 1,
      "settings":[]
    },
    {
      "type":"page",
      "name":"Content from Page",
      "settings":[
        {
        "type": "page",
        "id": "page",
        "label": "Show content from"
        }
      ]
    },
    {
      "type":"text",
      "name":"Tab Content",
      "settings":[
        {
          "type": "text",
          "id": "tab_heading",
          "label": "Tab Heading",
          "default": "Tab Heading"
        },
         {
          "type": "richtext",
          "id": "tab_content",
          "label": "Tab Content",
          "default": "<p>Enter the content to use inside the tab selected.</p>"
        }
    	]
    }
  ],
  "default": {
    "blocks": [
      {
        "type": "description"
      },
      {
        "type": "text"
      }
    ]
  }
}
{% endschema %}
