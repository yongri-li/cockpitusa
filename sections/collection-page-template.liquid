{% liquid
  assign number = section.settings.products_per_page
  assign sidebar = false
  assign sidebar_grid = 'lg-hide md-span-12 sm-span-12 auto'
  assign full_width = section.settings.full_width

  if section.settings.filter_position == 'left_sidebar'
    assign sidebar = true
    assign sidebar_grid = 'span-3 md-span-12 sm-span-12 auto'
  endif

  if section.settings.description_position == 'top_description' and collection.description != blank
    assign top_description = true
  else
    assign top_description = false
  endif

  case section.settings.grid
  when 2
    assign grid_item_width = 'span-6 md-span-6 sm-span-6 auto'
  when 3
    assign grid_item_width = 'span-4 md-span-4 sm-span-6 auto'
  when 4
    assign grid_item_width = 'span-3 md-span-4 sm-span-6 auto'
  when 5
    assign grid_item_width = ''
  when 6
    assign grid_item_width = 'span-2 md-span-4 sm-span-6 auto'
  endcase
%}
<div class="collection-page-{{ section.id }}" data-section-id="{{ section.id }}" data-section-type="collection-section">
  {% paginate collection.products by number %}

  {% if collection.description contains '[banner]' %}
    <div class="collection__page--banner collection-banner">
      {% render 'collection-banner-image', collection: collection %}
    </div>
  {% endif %}

    {% if full_width %}<div class="gridlock-fluid">{% endif %}
      <div id="content" class="row">
        <div id="main-content" class="grid_wrapper">

          {% render 'breadcrumb' %}

          <div class="collection__page--section-title section-title span-12 sm-span-12 auto">
            <h1>
              {% if collection.handle == 'all' %}
                {{ 'collections.general.all_products' | t }}
              {% else %}
                {{ collection.title }}
              {% endif %}
            </h1>
          </div>

          <div class="collection__page--sidebar desktop-sidebar {{ sidebar_grid }}">
            <div class="slideout__trigger--open lg-hide">
              <button class="slideout__trigger-filters js-slideout-open" data-wau-slideout-target="collection-filters" data-slideout-direction="right" aria-label="Open filters" tabindex="0" type="button" name="button">
                {{ 'collections.filter.refine' | t }}
              </button>
            </div>
            {% render 'collection-sidebar', collection: collection %}
          </div>

          <div class="collection__page--content {% if section.settings.filter_position == 'left_sidebar' %}span-9{% else %}span-12{% endif %} md-span-12 sm-span-12 auto">


            {% if section.blocks.size != 0 %}
              <div id="full-width-filter" class="collection__page--full-width-filters js-col-filter-full {% if sidebar %}lg-hide{% endif %} mobile-hide">
                {% for block in section.blocks %}
                  {% if block.type == 'vendor_list' %}
                    {% if collection.handle == "all" %}
                      <div class="collection__sidebar--filter-wrapper filter js-col-filter {% cycle '', 'right-filter' %}" {{ block.shopify_attributes }}>
                        <button class="collection__filters--trigger js-col-filter-trigger">
                          {{ block.settings.shop_by_designer_title }}
                        </button>
                        <ul class="collection__filters--filter-list js-col-filter-list" style="display: none;">
                          {% for product_vendor in shop.vendors %}
                          <li>{{ product_vendor | link_to_vendor  }}</li>
                          {% endfor %}
                        </ul>
                      </div>
                    {% else %}
                      <div class="collection__sidebar--filter-wrapper filter js-col-filter {% cycle '', 'right-filter' %}" {{ block.shopify_attributes }}>
                        <button class="collection__filters--trigger js-col-filter-trigger">
                          {{ block.settings.shop_by_designer_title }}
                        </button>
                        <ul class="collection__filters--filter-list js-col-filter-list">
                          {% for product_vendor in collection.all_vendors %}
                          <li class="{{ product_vendor | handelize }}">{{ product_vendor | link_to_vendor }}</li>
                          {% endfor %}
                        </ul>
                      </div>
                    {% endif %}
                  {% elsif block.type == 'menu' %}
                    <div class="collection__sidebar--filter-wrapper filter js-col-filter {% cycle '', 'right-filter' %}" {{ block.shopify_attributes }}>
                      <button class="collection__filters--trigger js-col-filter-trigger">
                        {{ block.settings.title }}
                      </button>
                      <ul class="collection__filters--filter-list js-col-filter-list sidebar-menu" style="display: none;">
                        {% for link in linklists[block.settings.side_nav].links %}
                        {% if link.links != blank %}
                        <li class="extend has_sub_menu" aria-haspopup="true" aria-expanded="false"><a href="{{ link.url }}">{{ link.title }}</a></li>
                        <ul class="extended-submenu">
                          {% for sub_link in link.links %}
                          <li><a href="{{ sub_link.url }}">{{ sub_link.title }}</a></li>
                          {% endfor %}
                        </ul>
                        {% else %}
                        <li>{{ link.title | link_to: link.url }}</li>
                        {% endif %}
                        {% endfor %}
                      </ul>
                    </div>
                  {% endif %}

                  {% render 'filters', collection: collection block: block, forloop: forloop %}
                {% endfor %}
              </div>
              <div class="clear"></div>
            {% endif %}

            <div id="current-filters" class="collection__filters--cur_wrapper span-12 md-span-12 sm-span-12 auto js-col-filters-current" style="display: none;">
              <h5>{{ 'collections.filter.filtering_by' | t }}</h5>
              <ul class="collection__filters--cur_list js-col-filters-current-list"></ul>
            </div>
            <div class="clear"></div>

            <div class="grid_wrapper product-loop{% if section.settings.infinite_scroll %} is_infinite{% endif %}">
              {% for product in collection.products %}
                <div class="{{ grid_item_width }} product-index" id="prod-{{ product.id }}" data-alpha="{{ product.title }}" data-price="{{ product.price }}" data-aos="{{ settings.scroll_animation }}" data-product-id="{{ product.id }}">
                  {% render 'product-listing', collection: collection, product: product %}
                </div>
              {% endfor %}
            </div>
            <div class="clear"></div>

            {% if top_description == false %}
              <div id="collection-description">
                <div class="rte">
                  {{ collection.description | remove: "[banner]" }}
                </div>
              </div>
            {% endif %}

          </div>

          <div class="clear"></div>

          {% render 'pagination', paginate: paginate %}


        </div>
      </div>
      <div id="collection-description" class="row">
        <div class="rte">
          {{ collection.description | remove: "[banner]" }}
        </div>
      </div>
    {% if full_width %}</div>{% endif %}
  {% assign sp_paginate_by = paginate.page_size %}{% endpaginate %}

  <style media="screen">
    {% if section.settings.grid == 5 %}
      @media screen and ( min-width: 981px ) {
        @supports (display: grid) {
          .collection-page-{{ section.id }} .product-loop.grid_wrapper {
              grid-template-columns: repeat(5, 1fr);
          }
        }
      }
      @media screen and ( min-width: 741px ) and ( max-width: 980px ) {
        @supports (display: grid) {
          .collection-page-{{ section.id }} .product-loop.grid_wrapper {
              grid-template-columns: repeat(3, 1fr);
          }
        }
      }
      @media screen and ( max-width: 740px ) {
        @supports (display: grid) {
          .collection-page-{{ section.id }} .product-loop.grid_wrapper {
              grid-template-columns: repeat(2, 1fr);
          }
        }
      }
    {% endif %}

    .collection__sidebar--filter-wrapper {
      color: {{ section.settings.filter_text_color }};
      border: 1px solid {{ section.settings.filter_border_color }};
      background-color: {{ section.settings.filter_bg_color }};
    }
    ul.collection__filters--filter-list {
      color: {{ section.settings.filter_text_color }};
      background-color: {{ section.settings.filter_bg_color }};
    }
    button.collection__filters--trigger:after {
      background-color: transparent;
      color: {{ section.settings.filter_text_color }};
    }
    ul.collection__filters--filter-list li a {
      color: {{ section.settings.filter_text_color }};
    }
    .collection__sidebar--wrapper .collection__sidebar--filter-wrapper button,
    .collection__filters--trigger button {
      border-color: {{ section.settings.filter_border_color }};
      color: {{ section.settings.filter_text_color }};
    }
  </style>
</div>

{% if sp_paginate_by %}{% render 'spurit_po2_collection_template_snippet', paginate_by: sp_paginate_by %}{% endif %}{% schema %}
{
  "name": "Collection Page",
	"max_blocks":12,
  "settings": [
    {
      "type": "checkbox",
      "id": "full_width",
      "label": "Full width"
    },
    {
      "type": "range",
      "id": "grid",
      "min": 2,
      "max": 6,
      "step": 1,
      "label": "Products per row",
      "default":4
    },
    {
      "type": "range",
      "id": "products_per_page",
      "min": 12,
      "max": 48,
      "step": 1,
      "label": "Products per page",
      "default":30
    },
    {
      "type": "checkbox",
      "id": "infinite_scroll",
      "label": "Infinite scroll products",
      "info": "Pagination will not show, products will continuously load as you scroll down the page"
    },
    {
      "type": "select",
      "id": "description_position",
      "options": [
        { "value": "top_description", "label": "Top of Page"},
        { "value": "bottom_description", "label": "Bottom of Page"}
      ],
      "label": "Description position",
      "default": "bottom_description"
    },
    {
      "type": "select",
      "id": "filter_position",
      "options": [
        { "value": "left_sidebar", "label": "Left Sidebar"},
        { "value": "top_filters", "label": "Top of Page"}
      ],
      "label": "Filters position",
      "default": "top_filters"
    },
    {
      "type": "checkbox",
      "id": "is_sticky",
      "label": "Make sidebar sticky",
      "default": false
    },
    {
      "type": "header",
      "content": "Filter Styles"
    },
    {
      "type": "color",
      "id": "filter_bg_color",
      "label": "Background color",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "filter_border_color",
      "label": "Border color",
      "default": "#333333"
    },
    {
      "type": "color",
      "id": "filter_text_color",
      "label": "Text color",
      "default": "#333333"
    }
  ],
  "blocks":[
  {
   "type":"menu",
   "name":"Menu",
   "settings":[
     {
       "type": "link_list",
       "id": "side_nav",
       "label": "Sidebar menu",
       "info":"This menu has limited support for dropdown items"
     },
     {
       "type": "text",
       "id": "title",
       "label": "Menu title",
       "default": "Explore"
     }
   ]
  },
  {
   "type":"vendor_list",
   "name":"Vendor list",
   "limit": 1,
   "settings":[
     {
       "type": "text",
       "id": "shop_by_designer_title",
       "label": "Vendor list title",
       "default": "Shop by Designer"
     }
   ]
  },
  {
   "type":"sort_by",
   "name":"Sort by",
   "limit": 1,
   "settings":[
     {
       "type": "text",
       "id": "sort_by_title",
       "label": "Sort by title",
       "default": "Sort"
     }
   ]
  },
  {
   "type":"filter",
   "name":"Tag Filter",
   "limit": 3,
   "settings":[
     {
       "type": "text",
       "id": "filter_by_title",
       "label": "Filter by title",
       "default": "Filter by"
     },
     {
       "type": "textarea",
       "id": "filter_by",
       "label": "Tag filter"
     }
   ]
  },
  {
   "type":"image",
   "name":"Image",
   "settings":[
     {
       "type":"paragraph",
       "content":"For sidebar position on desktop only"
     },
     {
       "type":"image_picker",
       "id":"image",
       "label":"Image",
       "info" : "1800px x 400px recommended"
     },
     {
       "type":"url",
       "id":"link",
       "label":"Link",
       "info":"Optional"
     }
   ]
  },
  {
   "type":"text_note",
   "name":"Text",
   "settings":[
     {
       "type":"paragraph",
       "content":"For sidebar position on desktop only"
     },
     {
       "type":"text",
       "id":"textbox_heading",
       "label":"Heading",
       "default": "Heading"
     },
     {
       "type":"richtext",
       "id":"textbox_subheading",
       "label":"Subheading",
       "default": "<p>Subheading</p>"
     },
     {
        "type": "select",
        "id": "subheading_align",
        "options": [
           { "value": "left", "label": "Left"},
           { "value": "center", "label": "Center"}
        ],
        "label": "Subheading alignment"
     }
   ]
  }
 ]
}
{% endschema %}
